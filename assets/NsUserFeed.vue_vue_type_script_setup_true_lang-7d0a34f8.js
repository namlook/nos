import{r as c,L as R,aa as M,ab as Z,i as T,a as j,d as A,ac as D,u as H,k as S,O as K,ad as O,ae as z,o as m,c as _,b as r,e as h,f as p,s as G,af as x,F as U,g as q,V as J,h as P}from"./index-1e8cf9a7.js";const{fetchUsersActivities:Q,fetchUserFollowers:W}=T(),X=new Map,I=new Map;function Y(f,u,{showReplies:s,showReactions:g,showReposts:w,showZaps:n}){const a=c(!1),l=c([]),o=R(()=>`${f.value}-${u.value}-${s.value}-${g.value}-${w.value}-${n.value}`),y=async()=>{a.value=!0;const d=Z(f.value);let v=[];u.value==="activity"?v=[d]:u.value==="feed"&&(v=await W(d));const V=await Q(v,{withReplies:s.value,withReactions:g.value,withReposts:w.value,withZaps:n.value});l.value=V,I.set(o.value,V),a.value=!1};return M(async()=>{const d=I.get(o.value);d!=null&&(l.value=d);const v=Date.now()-(X.get(o.value)??0)<1e3*60*5;(d==null||v)&&y()}),{isLoading:a,feed:l,refetch:async()=>{y()}}}const F=j({});function ee(f){return{lastSeenEventId:R({get(){return F[f]??""},set(s){F[f]=s}})}}const te={class:"ns-user-feed-component"},se={class:"flex justify-content-between mb-4 inset-shadow-1 p-3 border-round"},ae={class:"flex align-items-center gap-2"},le=r("i",{class:"pi pi-sync"},null,-1),oe={class:"flex align-items-center gap-2"},ne=r("i",{class:"pi pi-comments"},null,-1),ue={class:"flex align-items-center gap-2"},ie=r("i",{class:"pi pi-thumbs-up"},null,-1),ce={class:"flex align-items-center gap-2"},re=r("i",{class:"pi pi-bolt"},null,-1),de={key:0,class:"flex flex-column gap-4"},ve={key:1,class:"flex flex-column gap-4"},pe=["data-id"],he=A({__name:"NsUserFeed",props:{type:{type:String,required:!0},pubkey:{type:String,required:!0}},setup(f){const u=f,s=D(),g=H(),w=c(!1),n=c(!1),a=c(!1),l=c(!1),o=c(!1);S(()=>{n.value=s.query.showReplies==="true",a.value=s.query.showReactions==="true",l.value=s.query.showReposts==="true",o.value=s.query.showZaps==="true"}),K([n,a,l,o],()=>{g.push({...s,query:{...s.query,showReplies:n.value?"true":void 0,showReactions:a.value?"true":void 0,showReposts:l.value?"true":void 0,showZaps:o.value?"true":void 0}})});const y=R(()=>u.pubkey),b=R(()=>u.type),{isLoading:d,feed:v,refetch:V}=Y(y,b,{showReplies:n,showReactions:a,showReposts:l,showZaps:o});let $=c([]);const L=()=>{V()},{lastSeenEventId:E}=ee(`${u.pubkey}-${u.type}-${n.value}-${a.value}-${l.value}-${o.value}`),k=c("");O(()=>{E.value=k.value});function B(){for(let i=0;i<$.value.length&&$.value[i];i++){let t=$.value[i].getBoundingClientRect();if(t.top>=0&&t.top<t.height){const e=v.value[i].id;k.value!==e&&(k.value=e);break}}}return S(async()=>{window.addEventListener("scroll",B),await z();let i=document.querySelector(`[data-id="${E.value}"]`);i&&setTimeout(()=>{i.scrollIntoView()},200)}),(i,t)=>(m(),_("div",te,[r("div",se,[h(p(G),{class:"p-1",loading:w.value,outlined:"",icon:"pi pi-refresh",onClick:L},null,8,["loading"]),r("div",ae,[h(p(x),{modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e)},null,8,["modelValue"]),le]),r("div",oe,[h(p(x),{modelValue:n.value,"onUpdate:modelValue":t[1]||(t[1]=e=>n.value=e)},null,8,["modelValue"]),ne]),r("div",ue,[h(p(x),{modelValue:a.value,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value=e)},null,8,["modelValue"]),ie]),r("div",ce,[h(p(x),{modelValue:o.value,"onUpdate:modelValue":t[3]||(t[3]=e=>o.value=e)},null,8,["modelValue"]),re])]),p(d)?(m(),_("div",de,[(m(),_(U,null,q(5,e=>h(J,{key:e})),64))])):(m(),_("div",ve,[(m(!0),_(U,null,q(p(v),(e,C)=>(m(),_("div",{key:e.id,ref_for:!0,ref:N=>p($)[C]=N,"data-id":e.id},[h(P,{event:e},null,8,["event"])],8,pe))),128))]))]))}});export{he as _};
