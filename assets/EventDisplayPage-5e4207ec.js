import{d as E,r as s,n as g,x as D,o as n,j as h,c as _,b as I,F as j,f as B,y as P,_ as w,z as A,p as C,A as O}from"./index-ba76e8df.js";import{d as T,N as S,n as F,i as L,e as U,f as z,u as x,g as R}from"./NsEvent-48c491b9.js";const q={key:2},H=E({__name:"NsThread",props:{event:{type:Object},id:{type:String},root:{type:Object},inline:Boolean,inThread:Boolean},setup(r){const t=r,{fetch:f,get:l}=x(),e=s(t.event),a=s([]),o=s([]),i=s([]),c=s(!1);return g(async()=>{var d,k;c.value=!0;const p=t.id||((d=t.event)==null?void 0:d.id);if(p==null)throw new Error("id or event must be provided");if(t.event?e.value=t.event:e.value=await l({ids:[p],limit:10}),!e.value)throw c.value=!1,new Error("event not found");const y=((k=e.value)==null?void 0:k.schema.sameAs)??F.noteEncode(e.value.id),u=await f([{kinds:[1,7],"#e":[p],limit:1e3}],{batchId:"events"});a.value=u.filter(L).filter(v=>{var m,b,N;return((m=v.schema.parentItem)==null?void 0:m["@id"])===y||!((b=v.schema.parentItem)!=null&&b["@id"])&&((N=v.schema.mainEntity)==null?void 0:N["@id"])===y}).sort((v,m)=>v.created_at-m.created_at),o.value=u.filter(U),i.value=u.filter(z),c.value=!1}),(p,y)=>{const u=D("NsThread",!0);return c.value?(n(),h(T,{key:0,"in-thread":r.inThread},null,8,["in-thread"])):e.value?(n(),_("div",{key:1,class:P(["ns-thread-component",{"white-box":!r.inThread}])},[I(S,{event:e.value,"in-thread":"",comments:a.value,reactions:o.value,reposts:i.value},null,8,["event","comments","reactions","reposts"]),(n(!0),_(j,null,B(a.value,d=>(n(),h(u,{class:"ml-3 border-left-2 border-primary-100",key:d.id,event:d,root:r.root??e.value,"in-thread":""},null,8,["event","root"]))),128))],2)):(n(),_("div",q,"NOT FOUND"))}}}),V=w(H,[["__file","/Users/nicolasc/Documents/projects/others/nosworld/src/components/structures/NsThread/NsThread.vue"]]),$=E({__name:"EventDisplayPage",props:{id:{type:String,required:!0}},setup(r){const t=r,f=A(),l=C(()=>t.id.match(/^n(event|ote|pub|profile)1/)?R(t.id):t.id),e=s(),{get:a}=x(),o=s(!1);return g(async()=>{var i;if(o.value=!0,t.id.match(/^npub1/)?e.value=await a({kinds:[0],authors:[l.value]},{batchId:"authors"}):(e.value=await a({ids:[l.value]},{batchId:"events"}),e.value==null&&(e.value=await a({kinds:[0],authors:[t.id]},{batchId:"authors"}))),((i=e.value)==null?void 0:i.schema["@type"])==="Person"){f.push({name:O.profile.display,params:{pubkey:e.value.pubkey},replace:!0});return}o.value=!1}),(i,c)=>o.value?(n(),h(T,{key:0})):(n(),h(V,{key:1,id:l.value,event:e.value},null,8,["id","event"]))}}),K=w($,[["__file","/Users/nicolasc/Documents/projects/others/nosworld/src/pages/EventDisplayPage/EventDisplayPage.vue"]]);export{K as default};
