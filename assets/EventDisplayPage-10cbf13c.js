import{d as w,r as s,w as E,j as D,o as n,h as m,c as _,b as I,F as j,f as B,n as P,_ as g,k as C,i as O,l as S}from"./index-839bbb47.js";import{d as T,N as A,n as F,i as L,e as U,f as R,u as x,g as q}from"./NsEvent-be50e93a.js";const z={key:2},H=w({__name:"NsThread",props:{event:{type:Object},id:{type:String},root:{type:Object},inline:Boolean,inThread:Boolean},setup(r){const t=r,{fetch:f,get:l}=x(),e=s(t.event),a=s([]),o=s([]),i=s([]),c=s(!1);return E(async()=>{var d,k;c.value=!0;const p=t.id||((d=t.event)==null?void 0:d.id);if(p==null)throw new Error("id or event must be provided");if(t.event?e.value=t.event:e.value=await l({ids:[p],limit:10}),!e.value)throw c.value=!1,new Error("event not found");const y=((k=e.value)==null?void 0:k.schema.sameAs)??F.noteEncode(e.value.id),u=await f([{kinds:[1,7],"#e":[p],limit:1e3}],{batchId:"events"});a.value=u.filter(L).filter(v=>{var h,b,N;return((h=v.schema.parentItem)==null?void 0:h["@id"])===y||!((b=v.schema.parentItem)!=null&&b["@id"])&&((N=v.schema.mainEntity)==null?void 0:N["@id"])===y}).sort((v,h)=>v.created_at-h.created_at),o.value=u.filter(U),i.value=u.filter(R),c.value=!1}),(p,y)=>{const u=D("NsThread",!0);return c.value?(n(),m(T,{key:0,"in-thread":r.inThread},null,8,["in-thread"])):e.value?(n(),_("div",{key:1,class:P(["ns-thread-component",{"white-box":!r.inThread}])},[I(A,{event:e.value,"in-thread":"",comments:a.value,reactions:o.value,reposts:i.value},null,8,["event","comments","reactions","reposts"]),(n(!0),_(j,null,B(a.value,d=>(n(),m(u,{class:"ml-3 border-left-2 border-primary-100",key:d.id,event:d,root:r.root??e.value,"in-thread":""},null,8,["event","root"]))),128))],2)):(n(),_("div",z,"NOT FOUND"))}}}),V=g(H,[["__file","/Users/nicolasc/Documents/projects/others/nosworld/src/components/structures/NsThread/NsThread.vue"]]),$=w({__name:"EventDisplayPage",props:{id:{type:String,required:!0}},setup(r){const t=r,f=C(),l=O(()=>t.id.match(/^n(event|ote|pub|profile)1/)?q(t.id):t.id),e=s(),{get:a}=x(),o=s(!1);return E(async()=>{var i;if(o.value=!0,t.id.match(/^npub1/)?e.value=await a({kinds:[0],authors:[l.value]},{batchId:"authors"}):(e.value=await a({ids:[l.value]},{batchId:"events"}),e.value==null&&(e.value=await a({kinds:[0],authors:[t.id]},{batchId:"authors"}))),((i=e.value)==null?void 0:i.schema["@type"])==="Person"){f.push({name:S.profile.display,params:{pubkey:e.value.pubkey},replace:!0});return}o.value=!1}),(i,c)=>o.value?(n(),m(T,{key:0})):(n(),m(V,{key:1,id:l.value,event:e.value},null,8,["id","event"]))}}),K=g($,[["__file","/Users/nicolasc/Documents/projects/others/nosworld/src/pages/EventDisplayPage/EventDisplayPage.vue"]]);export{K as default};
